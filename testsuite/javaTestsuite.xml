<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Ant
 *
 * Copyright 2013-2014 IS2T. All rights reserved.
 * IS2T PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
-->

<project name="javaTestsuite" default="run" xmlns:testsuite="antlib:com.is2t.testsuite.ant">
	
	<dirname property="ant.dir.runTestsuite" file="${ant.file.runTestsuite}"/>

	<!-- Testsuite Configuration -->
	
	<property name="microej.launch.propertyfile" location="${ant.dir.runTestsuite}/../launch/Test1.properties"/>
	
	<path id="testsuite.tests.paths">
		<fileset dir="${ant.dir.runTestsuite}/../bin/">
			<include name="**/T*.class"/> 
		</fileset>
	</path>
	
	<path id="testsuite.ignored.tests.paths">
		<fileset dir="${ant.dir.runTestsuite}/../bin/">
			<include name="**/T*5.class"/> 
		</fileset>
	</path>
	
	<!-- Load platform.dir property -->
	<loadproperties srcFile="${microej.launch.propertyfile}">
      <filterchain><linecontains>
          <contains value="platform.dir"/>
      </linecontains></filterchain>
    </loadproperties>
	
	<fail unless="platform.dir" message="Please set the 'platform.dir' property."/>

	<!-- Import the script that defines the testsuite tasks  -->
	<import file="${platform.dir}/scripts/testsuiteDefinition.xml"/>
	
	<target name="run" depends="testsuite/definition">
		
		<!-- Launch test suite -->
		<testsuite:javaTestsuite
				outputDir="${ant.dir.runTestsuite}/../results~"
				harnessScript="${ant.dir.runTestsuite}/harness.xml"
				commonProperties="${microej.launch.propertyfile}"
		>
			<testPath refid="testsuite.tests.paths"/>
			<testIgnoredPath refid="testsuite.ignored.tests.paths"/>
		</testsuite:javaTestsuite>
		
		<!-- Generate HTML report -->
		<testsuite:htmlReport>
			<fileset dir="${testsuite.report.dir}">
				<include name="**/*.xml"/> <!-- include unary reports -->
				<exclude name="*.xml"/> <!-- exclude global report -->
			</fileset>
			<report format="noframes" todir="${testsuite.report.dir}"/>
		</testsuite:htmlReport>
	</target>
	
</project>